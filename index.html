<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Modern Video Portal</title>
  <style>
    :root{
      --bg:#071029;
      --panel:#081226;
      --muted:#9fb0c8;
      --accent:#ff6b6b;
      --accent2:#6bffde;
      --reels:#ff3b9a;
      --glass: rgba(255,255,255,0.03);
      --radius:12px;
      --shadow: 0 8px 30px rgba(2,6,23,0.6);
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;background:linear-gradient(180deg,#031028 0%, #071029 100%);color:#eaf6ff}

    .wrap{max-width:1200px;margin:20px auto;padding:18px;display:grid;grid-template-columns:260px 1fr;gap:18px}

    /* Sidebar */
    .sidebar{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));padding:14px;border-radius:14px;backdrop-filter:blur(12px)}
    .logo{display:flex;align-items:center;gap:10px}
    .logo .mark{width:46px;height:46px;border-radius:12px;background:linear-gradient(135deg,var(--accent),var(--accent2));display:grid;place-items:center;font-weight:700;box-shadow:0 4px 12px rgba(255,107,107,0.3)}
    h2{margin:6px 0 2px 0}
    .cats{margin-top:12px}
    .cat{padding:10px;border-radius:10px;cursor:pointer;display:flex;justify-content:space-between;align-items:center;transition:all 0.2s ease}
    .cat:hover{background:rgba(255,255,255,0.04);transform:translateX(4px)}
    .cat.active{background:linear-gradient(90deg, rgba(124,92,255,0.12), rgba(62,199,255,0.06));border-left:4px solid var(--accent)}
    .cat.admin-only{opacity:0.5;border-right:3px solid var(--accent2)}
    .cat.admin-only:hover{opacity:0.8}

    .add-cat{display:flex;gap:8px;margin-top:12px}
    input,select,textarea{background:rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.06);padding:10px;border-radius:10px;color:inherit;transition:all 0.2s}
    input:focus,select:focus,textarea:focus{outline:none;border-color:var(--accent);background:rgba(255,255,255,0.04)}

    /* Main */
    .main{display:flex;flex-direction:column;gap:12px}
    .player{background:var(--panel);padding:12px;border-radius:12px;box-shadow:var(--shadow);backdrop-filter:blur(20px)}
    video, iframe{width:100%;height:480px;border-radius:8px;background:#000}
    .reels-player{height:600px!important;max-width:350px;margin:0 auto}
    .meta{display:flex;justify-content:space-between;align-items:center;padding:10px;flex-wrap:wrap;gap:10px}
    .meta .title{font-weight:700;font-size:18px}
    .badge{display:inline-block;padding:4px 10px;border-radius:8px;font-size:11px;font-weight:600;margin-left:8px}
    .badge.reels{background:linear-gradient(90deg,var(--reels),#ff6b6b);color:#fff}
    .badge.admin{background:linear-gradient(90deg,#ffd93d,#ff6b6b);color:#061826}
    .controls{display:flex;gap:8px;flex-wrap:wrap}
    .btn{background:linear-gradient(90deg,var(--accent),var(--accent2));border:none;color:#061826;padding:10px 12px;border-radius:10px;cursor:pointer;font-weight:600;transition:all 0.3s;box-shadow:0 4px 12px rgba(255,107,107,0.2)}
    .btn:hover{transform:translateY(-2px);box-shadow:0 6px 18px rgba(255,107,107,0.4)}
    .btn.ghost{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted);box-shadow:none}
    .btn.ghost:hover{background:rgba(255,255,255,0.02);border-color:rgba(255,255,255,0.12)}

    /* Stats */
    .stats{display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:10px;margin-bottom:12px}
    .stat-card{background:linear-gradient(135deg,rgba(255,107,107,0.08),rgba(107,255,222,0.04));padding:14px;border-radius:10px;text-align:center}
    .stat-num{font-size:28px;font-weight:800;background:linear-gradient(90deg,var(--accent),var(--accent2));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
    .stat-label{font-size:12px;color:var(--muted);margin-top:4px}

    /* Grid */
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:12px}
    .card{background:linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01));padding:8px;border-radius:12px;cursor:pointer;transition:all 0.3s;position:relative}
    .card:hover{transform:translateY(-4px);box-shadow:0 8px 20px rgba(107,255,222,0.2)}
    .thumb{height:140px;border-radius:8px;overflow:hidden;background:#061426;display:flex;align-items:center;justify-content:center;position:relative}
    .thumb img{width:100%;height:100%;object-fit:cover}
    .thumb .duration{position:absolute;bottom:6px;right:6px;background:rgba(0,0,0,0.8);padding:4px 8px;border-radius:6px;font-size:11px;font-weight:600}
    .thumb .reels-badge{position:absolute;top:6px;left:6px;background:linear-gradient(135deg,var(--reels),#ff6b6b);padding:4px 8px;border-radius:6px;font-size:10px;font-weight:700;color:#fff}
    .card .title{margin-top:8px;font-weight:600;font-size:14px}
    .card .cat{font-size:12px;color:var(--muted);margin-top:4px}
    .card .actions{display:flex;gap:6px;margin-top:8px}

    /* Reels Section */
    .reels-section{background:linear-gradient(135deg,rgba(255,59,154,0.1),rgba(255,107,107,0.05));padding:16px;border-radius:12px;margin-bottom:12px}
    .reels-section h3{margin:0 0 10px 0;display:flex;align-items:center;gap:8px}
    .reels-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(120px,1fr));gap:10px}
    .reels-card{aspect-ratio:9/16;border-radius:10px;overflow:hidden;cursor:pointer;position:relative;transition:all 0.3s}
    .reels-card:hover{transform:scale(1.05)}
    .reels-card img{width:100%;height:100%;object-fit:cover}
    .reels-card .overlay{position:absolute;inset:0;background:linear-gradient(to top,rgba(0,0,0,0.8),transparent);display:flex;flex-direction:column;justify-content:flex-end;padding:8px}
    .reels-card .title{font-size:11px;font-weight:600;color:#fff}

    /* Admin Modal */
    .modal{position:fixed;inset:0;display:grid;place-items:center;background:linear-gradient(0deg, rgba(0,0,0,0.7), rgba(0,0,0,0.7));padding:18px;z-index:1000;backdrop-filter:blur(4px)}
    .modal-card{width:860px;max-width:95vw;background:linear-gradient(180deg,#041029,#051126);padding:20px;border-radius:14px;box-shadow:0 20px 60px rgba(0,0,0,0.8);max-height:90vh;overflow-y:auto}
    .row{display:flex;gap:12px}
    .col{flex:1}
    .small{font-size:13px;color:var(--muted)}

    /* upload area */
    .upload-drop{height:120px;border-radius:10px;border:2px dashed rgba(255,255,255,0.1);display:grid;place-items:center;cursor:pointer;transition:all 0.2s}
    .upload-drop:hover{border-color:var(--accent);background:rgba(255,107,107,0.02)}

    /* Toggle Switch */
    .toggle{display:flex;align-items:center;gap:10px;margin:8px 0}
    .toggle input{width:50px;height:24px;appearance:none;background:rgba(255,255,255,0.1);border-radius:20px;position:relative;cursor:pointer;transition:all 0.3s}
    .toggle input:checked{background:linear-gradient(90deg,var(--accent),var(--accent2))}
    .toggle input::before{content:'';position:absolute;width:18px;height:18px;background:#fff;border-radius:50%;top:3px;left:3px;transition:all 0.3s}
    .toggle input:checked::before{left:29px}

    /* Search */
    .search-box{display:flex;gap:8px;margin-bottom:12px;align-items:center}
    .search-input{flex:1;padding:12px;border-radius:10px;background:rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.06)}

    footer{margin-top:14px;color:var(--muted);font-size:13px;text-align:center}

    @media (max-width:980px){
      .wrap{grid-template-columns:1fr;}.sidebar{order:2}
      .modal-card{width:100%}.row{flex-direction:column}
      .stats{grid-template-columns:repeat(2,1fr)}
    }
  </style>
</head>
<body>
  <div style="max-width:1200px;margin:12px auto;padding:10px">
    <div style="display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap">
      <div style="display:flex;align-items:center;gap:12px">
        <div style="width:58px;height:58px;border-radius:12px;background:linear-gradient(135deg,var(--accent),var(--accent2));display:grid;place-items:center;font-weight:800;color:#061826;box-shadow:0 6px 20px rgba(255,107,107,0.4)">VP</div>
        <div>
          <div style="font-weight:700;font-size:18px">Video Portal Pro</div>
          <div class="small">üé• Reels, Admin Panel & Advanced Features</div>
        </div>
      </div>
      <div style="display:flex;gap:8px;align-items:center;flex-wrap:wrap">
        <span id="loginStatus" class="small"></span>
        <button class="btn" id="openAdmin">Admin</button>
        <button class="btn ghost" id="searchToggle">üîç Ara</button>
        <a class="btn ghost" href="#" id="helpBtn">Yardƒ±m</a>
      </div>
    </div>
  </div>

  <div class="wrap">
    <aside class="sidebar">
      <div class="logo"><div class="mark">VP</div><div><h2>Videolar</h2><div class="small">Kategoriler ve filtre</div></div></div>
      
      <div class="search-box" id="searchBox" style="display:none">
        <input class="search-input" id="searchInput" placeholder="Video ara..." />
        <button class="btn ghost" id="clearSearch">‚úï</button>
      </div>

      <div class="cats" id="catsList"></div>
      
      <div class="add-cat" id="addCatSection">
        <input id="newCatInput" placeholder="Yeni kategori" />
        <button class="btn" id="addCatBtn">Ekle</button>
      </div>

      <div style="margin-top:18px" id="quickSettings">
        <h4 class="small">Hƒ±zlƒ± Ayarlar</h4>
        <div style="height:8px"></div>
        <input id="siteTitleInput" placeholder="Site ba≈ülƒ±ƒüƒ±nƒ± deƒüi≈ütir" />
        <div style="height:8px"></div>
        <button class="btn" id="saveTitle">Kaydet</button>
      </div>
    </aside>

    <main class="main">
      <div class="stats" id="statsSection">
        <div class="stat-card">
          <div class="stat-num" id="totalVideos">0</div>
          <div class="stat-label">Toplam Video</div>
        </div>
        <div class="stat-card">
          <div class="stat-num" id="totalReels">0</div>
          <div class="stat-label">Reels</div>
        </div>
        <div class="stat-card">
          <div class="stat-num" id="totalCats">0</div>
          <div class="stat-label">Kategori</div>
        </div>
      </div>

      <div class="player" id="playerCard">
        <div id="playerWrap"><video id="mainPlayer" controls playsinline crossorigin><source id="mainSource" src="https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4" type="video/mp4"></video></div>
        <div class="meta">
          <div>
            <div class="title" id="mainTitle">Big Buck Bunny (√∂rnek)</div>
            <div class="small" id="mainCategory">√ñrnek</div>
          </div>
          <div class="controls">
            <button class="btn ghost" id="prevBtn">‚¨Ö √ñnceki</button>
            <button class="btn ghost" id="nextBtn">Sonraki ‚û°</button>
            <button class="btn ghost" id="fullscreenBtn">‚õ∂ Tam Ekran</button>
          </div>
        </div>
      </div>

      <div class="reels-section" id="reelsSection" style="display:none">
        <h3>üî• Reels <span class="badge reels">Yeni</span></h3>
        <div class="reels-grid" id="reelsGrid"></div>
      </div>

      <div class="grid" id="videoGrid"></div>

      <footer>Geli≈ümi≈ü √∂zellikler: Reels desteƒüi, Admin korumasƒ±, Arama, ƒ∞statistikler ve daha fazlasƒ±!</footer>
    </main>
  </div>

  <!-- Admin Modal -->
  <div id="adminModal" class="modal" style="display:none">
    <div class="modal-card">
      <div id="loginView">
        <h3>üîê Admin Giri≈üi</h3>
        <div class="small">Sadece yetkili kullanƒ±cƒ±lar i√ßin</div>
        <div style="height:8px"></div>
        <input id="adminPassInput" type="password" placeholder="≈ûifre giriniz" />
        <div style="height:10px"></div>
        <div style="display:flex;gap:8px">
          <button class="btn" id="loginBtn">Giri≈ü Yap</button>
          <button class="btn ghost" id="closeAdmin">Kapat</button>
        </div>
      </div>

      <div id="panelView" style="display:none">
        <div style="display:flex;justify-content:space-between;align-items:center;gap:8px;margin-bottom:10px;flex-wrap:wrap">
          <h3>‚öôÔ∏è Admin Panel</h3>
          <div class="small">Kullanƒ±cƒ±: <strong>Admin</strong> <span class="badge admin">Y√∂netici</span></div>
        </div>

        <div class="row">
          <div class="col">
            <h4>üìπ Yeni Video Ekle</h4>
            <div class="small">Video, Iframe veya Reels formatƒ±nda i√ßerik ekleyin</div>
            <div style="height:8px"></div>

            <label class="small">Video ba≈ülƒ±ƒüƒ± *</label>
            <input id="v_title" placeholder="Ba≈ülƒ±k giriniz" />

            <label class="small" style="margin-top:8px">Kategori *</label>
            <select id="v_cat"></select>

            <label class="small" style="margin-top:8px">Thumbnail URL</label>
            <input id="v_thumb" placeholder="https://..." />

            <div style="height:8px"></div>
            <label class="small">ƒ∞√ßerik T√ºr√º *</label>
            <select id="v_type">
              <option value="mp4">üé¨ MP4 Link</option>
              <option value="iframe">üì∫ Iframe Embed</option>
              <option value="reels">üî• Reels (30sn altƒ±)</option>
              <option value="upload">üì§ Dosya Y√ºkle</option>
            </select>

            <div id="typeArea" style="margin-top:8px"></div>

            <div class="toggle" style="margin-top:12px">
              <input type="checkbox" id="adminOnlyToggle" />
              <label class="small">Sadece Admin G√∂rs√ºn</label>
            </div>

            <div style="height:8px"></div>
            <div style="display:flex;gap:8px">
              <button class="btn" id="saveVideoBtn">‚úì Ekle</button>
              <button class="btn ghost" id="cancelPanel">ƒ∞ptal</button>
            </div>

            <hr style="margin:14px 0;border:none;border-top:1px solid rgba(255,255,255,0.03)" />

            <h4>üìÇ Kategoriler</h4>
            <div id="panelCats"></div>

          </div>

          <div class="col">
            <h4>üíæ Veri ƒ∞≈ülemleri</h4>
            <div style="display:flex;gap:8px;margin-bottom:8px;flex-wrap:wrap">
              <button class="btn" id="exportBtn">üì• Dƒ±≈üa Aktar</button>
              <button class="btn ghost" id="importBtn">üì§ ƒ∞√ße Aktar</button>
            </div>
            
            <h4 style="margin-top:16px">üìã Video Listesi</h4>
            <div style="margin-top:8px" id="videosAdminList"></div>
            <div style="height:12px"></div>
            <button class="btn ghost" id="logoutBtn">üö™ √áƒ±kƒ±≈ü Yap</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // CONFIG
    const CONFIG = { 
      adminPassword: 'scholse', 
      videosKey: 'vs_videos', 
      catsKey: 'vs_categories', 
      siteKey: 'vs_title',
      sessionKey: 'vs_admin_session'
    }

    // helpers
    const $ = sel => document.querySelector(sel)
    const $$ = sel => document.querySelectorAll(sel)
    function load(key, fallback){ try{const v=localStorage.getItem(key); return v?JSON.parse(v):fallback}catch(e){return fallback} }
    function save(key,obj){ localStorage.setItem(key, JSON.stringify(obj)) }
    function id(){ return Math.random().toString(36).slice(2,9) }

    // data
    let videos = load(CONFIG.videosKey, [ 
      {id:id(), title:'Big Buck Bunny (√∂rnek)', url:'https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4', type:'mp4', category:'√ñrnek', thumb:'https://peach.blender.org/wp-content/uploads/title_anouncement.jpg?x11217', adminOnly: false}
    ])
    let categories = load(CONFIG.catsKey, ['√ñrnek','Sinema','Reels','Uncategorized'])
    let isAdmin = sessionStorage.getItem(CONFIG.sessionKey) === 'true'
    let searchQuery = ''

    // elements
    const catsList = $('#catsList'), videoGrid = $('#videoGrid'), reelsGrid = $('#reelsGrid'), mainPlayer = $('#mainPlayer')
    const mainTitle = $('#mainTitle'), mainCategory = $('#mainCategory'), mainSource = $('#mainSource')
    const openAdmin = $('#openAdmin'), adminModal = $('#adminModal'), closeAdmin = $('#closeAdmin')
    const loginBtn = $('#loginBtn'), adminPassInput = $('#adminPassInput'), loginView = $('#loginView')
    const panelView = $('#panelView'), panelCats = $('#panelCats'), v_cat = $('#v_cat'), v_type = $('#v_type')
    const typeArea = $('#typeArea'), reelsSection = $('#reelsSection'), searchBox = $('#searchBox')
    const searchInput = $('#searchInput'), loginStatus = $('#loginStatus')

    // Update UI based on admin status
    function updateAdminUI() {
      loginStatus.textContent = isAdmin ? '‚úì Giri≈ü yapƒ±ldƒ±' : ''
      $('#addCatSection').style.display = isAdmin ? 'flex' : 'none'
      $('#quickSettings').style.display = isAdmin ? 'block' : 'none'
    }

    // render functions
    function renderCats(){ 
      catsList.innerHTML=''
      const allCat = document.createElement('div')
      allCat.className='cat'+(activeCat==='Hepsi'?' active':'')
      allCat.innerHTML=`<div>üì∫ Hepsi</div><div class="small">${videos.filter(v=>!v.adminOnly || isAdmin).length}</div>`
      allCat.onclick=()=>setActiveCategory('Hepsi')
      catsList.appendChild(allCat)

      categories.forEach(c=>{ 
        const visibleCount = videos.filter(v=>v.category===c && (!v.adminOnly || isAdmin)).length
        if(visibleCount === 0 && !isAdmin) return
        
        const el=document.createElement('div')
        el.className='cat'+(c===activeCat?' active':'')
        if(videos.some(v=>v.category===c && v.adminOnly)) el.classList.add('admin-only')
        const icon = c==='Reels'?'üî•':'üìÅ'
        el.innerHTML=`<div>${icon} ${c}</div><div class="small">${visibleCount}</div>`
        el.onclick=()=>setActiveCategory(c)
        catsList.appendChild(el)
      })
    }

    function renderPanelCats(){ 
      panelCats.innerHTML=''
      categories.forEach(c=>{ 
        const r=document.createElement('div')
        r.style.display='flex'
        r.style.justifyContent='space-between'
        r.style.padding='8px'
        r.style.borderTop='1px solid rgba(255,255,255,0.02)'
        r.innerHTML=`<div><strong>${escapeHtml(c)}</strong> <span class="small">(${videos.filter(v=>v.category===c).length} video)</span></div>`
        const b=document.createElement('button')
        b.className='btn ghost'
        b.textContent='üóëÔ∏è Sil'
        b.onclick=()=>{ 
          if(confirm(c+' kategorisini silmek istediƒüinize emin misiniz? Bu kategoriye ait videolar "Uncategorized" olacak.')){ 
            videos = videos.map(v=>v.category===c?{...v,category:'Uncategorized'}:v)
            categories = categories.filter(x=>x!==c)
            saveAll()
            renderAll()
          }
        }
        r.appendChild(b)
        panelCats.appendChild(r)
      })
    }

    function renderGrid(filter){ 
      videoGrid.innerHTML=''
      let list = videos.filter(v=> {
        if(v.adminOnly && !isAdmin) return false
        if(v.type === 'reels') return false
        if(filter!=='Hepsi' && v.category!==filter) return false
        if(searchQuery && !v.title.toLowerCase().includes(searchQuery.toLowerCase())) return false
        return true
      })
      
      if(list.length === 0){
        videoGrid.innerHTML = '<div style="grid-column:1/-1;text-align:center;padding:40px;color:var(--muted)">üîç Video bulunamadƒ±</div>'
        return
      }

      list.forEach(v=>{ 
        const c=document.createElement('div')
        c.className='card'
        const adminBadge = v.adminOnly ? '<span class="badge admin">Admin</span>' : ''
        c.innerHTML=`
          <div class="thumb">
            ${v.thumb?`<img src="${v.thumb}" alt="${escapeHtml(v.title)}"/>`:`<div style="padding:12px;color:var(--muted)">üé¨</div>`}
          </div>
          <div class="title">${escapeHtml(v.title)} ${adminBadge}</div>
          <div class="cat">üìÅ ${escapeHtml(v.category)}</div>
          <div class="actions">
            <button class="btn" onclick="playVideo('${v.id}')">‚ñ∂ Oynat</button>
            ${isAdmin?`<button class="btn ghost" onclick="editVideo('${v.id}')">‚úèÔ∏è</button>`:''}
          </div>
        `
        videoGrid.appendChild(c)
      })
    }

    function renderReels(){
      const reelsList = videos.filter(v=> v.type==='reels' && (!v.adminOnly || isAdmin))
      if(reelsList.length === 0){
        reelsSection.style.display = 'none'
        return
      }
      reelsSection.style.display = 'block'
      reelsGrid.innerHTML = ''
      reelsList.forEach(v=>{
        const card = document.createElement('div')
        card.className = 'reels-card'
        card.onclick = ()=>playVideo(v.id)
        card.innerHTML = `
          ${v.thumb?`<img src="${v.thumb}" alt="${escapeHtml(v.title)}"/>`:`<div style="background:linear-gradient(135deg,var(--reels),#ff6b6b);width:100%;height:100%;display:grid;place-items:center;color:#fff;font-weight:700">REELS</div>`}
          <div class="overlay">
            <div class="title">${escapeHtml(v.title)}</div>
          </div>
        `
        reelsGrid.appendChild(card)
      })
    }

    function renderStats(){
      const visibleVideos = videos.filter(v=>!v.adminOnly || isAdmin)
      $('#totalVideos').textContent = visibleVideos.length
      $('#totalReels').textContent = visibleVideos.filter(v=>v.type==='reels').length
      $('#totalCats').textContent = categories.length
    }

    function escapeHtml(s){ return String(s).replace(/[&<>"']/g, c=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"}[c])) }

    // active category
    let activeCat = 'Hepsi'
    function setActiveCategory(c){ activeCat = c; renderAll(); }

    // play helpers
    window.playVideo = function(vid){ 
      const v = videos.find(x=>x.id===vid)
      if(!v) return alert('Video bulunamadƒ±')
      if(v.adminOnly && !isAdmin) return alert('Bu i√ßerik sadece adminler i√ßin!')
      
      const playerWrap = $('#playerWrap')
      if(v.type==='iframe'){ 
        playerWrap.innerHTML = `<iframe src="${v.url}" frameborder="0" allowfullscreen allow="autoplay"></iframe>`
      } else if(v.type==='reels'){
        playerWrap.innerHTML = `<video id="mainPlayer" controls playsinline crossorigin class="reels-player"><source src="${v.url}" type="video/mp4"></video>`
      } else {
        playerWrap.innerHTML = `<video id="mainPlayer" controls playsinline crossorigin><source src="${v.url}" type="video/mp4"></video>`
      }
      mainTitle.innerHTML = escapeHtml(v.title) + (v.type==='reels'?'<span class="badge reels">Reels</span>':'') + (v.adminOnly?'<span class="badge admin">Admin</span>':'')
      mainCategory.textContent = 'üìÅ ' + v.category
      
      // scroll to player
      $('#playerCard').scrollIntoView({behavior:'smooth', block:'center'})
    }

    // edit
    window.editVideo = function(vid){ 
      if(!isAdmin) return alert('Admin yetkisi gerekli!')
      adminModal.style.display='grid'
      loginView.style.display='none'
      panelView.style.display='block'
      loadPanelHome()
      openEdit(vid)
    }

    // prev/next
    $('#prevBtn').onclick = ()=>{ 
      const cur = findCurrent()
      if(cur>0) playVideo(videos[cur-1].id)
    }
    $('#nextBtn').onclick = ()=>{ 
      const cur = findCurrent()
      if(cur<videos.length-1) playVideo(videos[cur+1].id)
    }
    $('#fullscreenBtn').onclick = ()=>{
      const player = document.querySelector('#playerWrap video, #playerWrap iframe')
      if(player && player.requestFullscreen) player.requestFullscreen()
    }
    
    function findCurrent(){ 
      const player = document.querySelector('#playerWrap video')
      if(!player) return -1
      const src = player.currentSrc || player.src
      return videos.findIndex(v=>v.url===src)
    }

    // admin modal control
    openAdmin.onclick = ()=>{ 
      if(isAdmin){
        adminModal.style.display='grid'
        loginView.style.display='none'
        panelView.style.display='block'
        loadPanelHome()
      } else {
        adminModal.style.display='grid'
        loginView.style.display='block'
        panelView.style.display='none'
        adminPassInput.value=''
        adminPassInput.focus()
      }
    }
    closeAdmin.onclick = ()=>{ adminModal.style.display='none' }
    $('#cancelPanel').onclick = ()=>{ adminModal.style.display='none' }

    loginBtn.onclick = ()=>{ 
      if(adminPassInput.value===CONFIG.adminPassword){ 
        isAdmin = true
        sessionStorage.setItem(CONFIG.sessionKey, 'true')
        loginView.style.display='none'
        panelView.style.display='block'
        loadPanelHome()
        updateAdminUI()
        renderAll()
      } else {
        alert('‚ùå Hatalƒ± ≈üifre!')
        adminPassInput.value = ''
        adminPassInput.focus()
      }
    }
    
    adminPassInput.onkeypress = (e)=>{
      if(e.key==='Enter') loginBtn.click()
    }

    $('#logoutBtn').onclick = ()=>{ 
      if(confirm('√áƒ±kƒ±≈ü yapmak istediƒüinize emin misiniz?')){
        isAdmin = false
        sessionStorage.removeItem(CONFIG.sessionKey)
        panelView.style.display='none'
        loginView.style.display='block'
        adminModal.style.display='none'
        updateAdminUI()
        renderAll()
      }
    }

    // panel home
    function loadPanelHome(){ 
      v_cat.innerHTML=''
      categories.forEach(c=>{ 
        const o=document.createElement('option')
        o.value=c
        o.textContent=c
        v_cat.appendChild(o)
      })
      renderPanelCats()
      renderVideosAdmin()
      renderTypeArea()
      
      // Reset form
      $('#v_title').value = ''
      $('#v_thumb').value = ''
      $('#adminOnlyToggle').checked = false
      v_type.value = 'mp4'
      
      // Reset save button
      $('#saveVideoBtn').onclick = saveNewVideo
    }

    function renderVideosAdmin(){ 
      const box = $('#videosAdminList')
      box.innerHTML=''
      if(videos.length === 0){
        box.innerHTML = '<div class="small" style="padding:12px;text-align:center">Hen√ºz video yok</div>'
        return
      }
      videos.forEach(v=>{ 
        const r=document.createElement('div')
        r.style.padding='10px'
        r.style.borderTop='1px solid rgba(255,255,255,0.03)'
        r.style.background='rgba(255,255,255,0.01)'
        r.style.borderRadius='8px'
        r.style.marginBottom='6px'
        const badges = []
        if(v.type==='reels') badges.push('<span class="badge reels">Reels</span>')
        if(v.adminOnly) badges.push('<span class="badge admin">Admin</span>')
        r.innerHTML = `<strong>${escapeHtml(v.title)}</strong> ${badges.join(' ')}<div class="small">üìÅ ${escapeHtml(v.category)} ‚Ä¢ ${v.type}</div>`
        const ed = document.createElement('div')
        ed.style.display='flex'
        ed.style.gap='6px'
        ed.style.marginTop='8px'
        
        const ebtn=document.createElement('button')
        ebtn.className='btn ghost'
        ebtn.textContent='‚úèÔ∏è D√ºzenle'
        ebtn.onclick=()=>openEdit(v.id)
        
        const dbtn=document.createElement('button')
        dbtn.className='btn'
        dbtn.textContent='üóëÔ∏è Sil'
        dbtn.onclick=()=>{ 
          if(confirm('Bu videoyu silmek istediƒüinize emin misiniz?')){ 
            videos = videos.filter(x=>x.id!==v.id)
            saveAll()
            renderAll()
            loadPanelHome()
          }
        }
        
        ed.appendChild(ebtn)
        ed.appendChild(dbtn)
        r.appendChild(ed)
        box.appendChild(r)
      })
    }

    // type area
    function renderTypeArea(){ 
      const t = v_type.value
      typeArea.innerHTML=''
      
      if(t==='mp4'){ 
        typeArea.innerHTML = `<label class="small">MP4 Video Linki</label><input id="v_url" placeholder="https://example.com/video.mp4" />`
      } else if(t==='iframe'){ 
        typeArea.innerHTML = `<label class="small">Iframe URL</label><input id="v_url" placeholder="https://www.youtube.com/embed/..." /><div class="small" style="margin-top:6px">YouTube, Vimeo vb. embed linklerini buraya yapƒ±≈ütƒ±rƒ±n</div>`
      } else if(t==='reels'){
        typeArea.innerHTML = `<label class="small">Reels Video Linki (30 saniye altƒ±)</label><input id="v_url" placeholder="https://example.com/short-video.mp4" /><div class="small" style="margin-top:6px">‚ö†Ô∏è Sadece 30 saniye ve altƒ± videolar i√ßin kullanƒ±n</div>`
      } else { 
        typeArea.innerHTML = `
          <label class="small">Video Dosyasƒ± Se√ß</label>
          <div class="upload-drop" id="dropArea">
            <div style="text-align:center">
              <div style="font-size:32px">üì§</div>
              <div class="small">Dosyayƒ± s√ºr√ºkle-bƒ±rak veya tƒ±kla</div>
            </div>
          </div>
          <input type="file" id="fileInput" style="display:none" accept="video/*" />
          <div class="small" style="margin-top:8px">‚ö†Ô∏è Upload: Transfer.sh kullanƒ±lƒ±r (ge√ßici). Kalƒ±cƒ± dosyalar i√ßin manuel hosting √∂nerilir.</div>
        `
        const drop = $('#dropArea')
        const fin = $('#fileInput')
        drop.onclick = ()=>fin.click()
        fin.onchange = e=>handleFileUpload(e.target.files[0])
        drop.ondrop = e=>{ e.preventDefault(); handleFileUpload(e.dataTransfer.files[0]) }
        drop.ondragover = e=>{ e.preventDefault(); drop.style.borderColor='var(--accent)' }
        drop.ondragleave = e=>{ e.preventDefault(); drop.style.borderColor='' }
      }
    }
    v_type.onchange = renderTypeArea

    // save new video
    async function saveNewVideo(){
      const title = $('#v_title').value.trim()
      const cat = $('#v_cat').value
      const thumb = $('#v_thumb').value.trim()
      const type = v_type.value
      const adminOnly = $('#adminOnlyToggle').checked
      
      if(!title) return alert('‚ö†Ô∏è Ba≈ülƒ±k gerekli!')
      
      if(type==='upload'){ 
        if(!lastUploadedUrl) return alert('‚ö†Ô∏è √ñnce dosya y√ºkleyin!')
        videos.unshift({
          id:id(), 
          title, 
          url:lastUploadedUrl, 
          type:'mp4', 
          category:cat||'Uncategorized', 
          thumb,
          adminOnly
        })
        lastUploadedUrl = null
      } else { 
        const url = $('#v_url')?$('#v_url').value.trim():''
        if(!url) return alert('‚ö†Ô∏è URL gerekli!')
        videos.unshift({
          id:id(), 
          title, 
          url, 
          type:type, 
          category:cat||'Uncategorized', 
          thumb,
          adminOnly
        })
      }
      
      saveAll()
      renderAll()
      loadPanelHome()
      alert('‚úÖ Video ba≈üarƒ±yla eklendi!')
    }

    // upload handling
    let lastUploadedUrl = null
    async function handleFileUpload(file){ 
      if(!file) return
      const drop = $('#dropArea')
      drop.innerHTML = '<div style="text-align:center"><div style="font-size:32px">‚è≥</div><div class="small">Y√ºkleniyor...</div></div>'
      
      try{
        const res = await fetch('https://transfer.sh/' + encodeURIComponent(file.name), { 
          method: 'PUT', 
          body: file 
        })
        if(!res.ok) throw new Error('Upload ba≈üarƒ±sƒ±z: '+res.status)
        const text = await res.text()
        lastUploadedUrl = text.trim()
        drop.innerHTML = `<div style="text-align:center;padding:12px"><div style="font-size:32px">‚úÖ</div><div class="small">Y√ºklendi!</div><div style="font-size:11px;word-break:break-all;margin-top:6px;color:var(--accent2)">${lastUploadedUrl}</div></div>`
        alert('‚úÖ Dosya y√ºklendi!\n\n‚ö†Ô∏è Not: Transfer.sh ge√ßici bir servistir. Kalƒ±cƒ± hosting i√ßin videoyu kendi sunucunuza y√ºkleyin.')
      }catch(err){ 
        console.error(err)
        drop.innerHTML = '<div style="text-align:center;color:var(--accent)"><div style="font-size:32px">‚ùå</div><div class="small">Y√ºkleme ba≈üarƒ±sƒ±z</div></div>'
        alert('‚ùå Y√ºkleme ba≈üarƒ±sƒ±z: ' + err.message)
      }
    }

    // edit open
    function openEdit(vid){ 
      const v = videos.find(x=>x.id===vid)
      if(!v) return alert('Video bulunamadƒ±!')
      
      $('#v_title').value = v.title
      $('#v_thumb').value = v.thumb||''
      v_cat.value = v.category||categories[0] || 'Uncategorized'
      v_type.value = v.type==='reels'?'reels':(v.type==='iframe'?'iframe':'mp4')
      $('#adminOnlyToggle').checked = v.adminOnly || false
      renderTypeArea()
      
      setTimeout(()=>{ 
        if($('#v_url')) $('#v_url').value = v.url 
      },100)
      
      $('#saveVideoBtn').onclick = ()=>{ 
        v.title = $('#v_title').value.trim()
        v.thumb = $('#v_thumb').value.trim()
        v.category = $('#v_cat').value
        v.adminOnly = $('#adminOnlyToggle').checked
        const t = v_type.value
        
        if(t==='upload'){ 
          if(!lastUploadedUrl) return alert('‚ö†Ô∏è √ñnce dosya y√ºkle!')
          v.url = lastUploadedUrl
          v.type='mp4'
          lastUploadedUrl = null
        } else { 
          const url = $('#v_url')?$('#v_url').value.trim():''
          if(!url) return alert('‚ö†Ô∏è URL gerekli!')
          v.url = url
          v.type = t
        }
        
        saveAll()
        renderAll()
        loadPanelHome()
        alert('‚úÖ Video g√ºncellendi!')
      }
    }

    // export/import
    $('#exportBtn').onclick = ()=>{ 
      const data = {videos, categories, version:'2.0'}
      const blob = new Blob([JSON.stringify(data,null,2)],{type:'application/json'})
      const url = URL.createObjectURL(blob)
      const a=document.createElement('a')
      a.href=url
      a.download='video-portal-backup-'+Date.now()+'.json'
      a.click()
      alert('‚úÖ Veriler dƒ±≈üa aktarƒ±ldƒ±!')
    }
    
    $('#importBtn').onclick = ()=>{ 
      const inp = document.createElement('input')
      inp.type='file'
      inp.accept='application/json'
      inp.onchange = e=>{ 
        const f=e.target.files[0]
        const r=new FileReader()
        r.onload = ev=>{ 
          try{ 
            const obj = JSON.parse(ev.target.result)
            if(obj.videos && obj.categories){ 
              if(confirm('‚ö†Ô∏è Mevcut veriler silinecek. Devam edilsin mi?')){
                videos = obj.videos
                categories = obj.categories
                saveAll()
                renderAll()
                loadPanelHome()
                alert('‚úÖ ƒ∞√ße aktarƒ±m ba≈üarƒ±lƒ±!')
              }
            } else {
              alert('‚ùå Ge√ßersiz dosya formatƒ±!')
            }
          }catch(err){ 
            alert('‚ùå Hata: '+err.message)
          }
        }
        r.readAsText(f)
      }
      inp.click()
    }

    // add category
    $('#addCatBtn').onclick = ()=>{ 
      const n = $('#newCatInput').value.trim()
      if(!n) return alert('‚ö†Ô∏è Kategori adƒ± giriniz!')
      if(categories.includes(n)) return alert('‚ö†Ô∏è Bu kategori zaten mevcut!')
      categories.push(n)
      saveAll()
      renderAll()
      $('#newCatInput').value=''
      alert('‚úÖ Kategori eklendi: ' + n)
    }

    // search
    $('#searchToggle').onclick = ()=>{
      if(searchBox.style.display==='none'){
        searchBox.style.display='flex'
        searchInput.focus()
      } else {
        searchBox.style.display='none'
        searchQuery = ''
        searchInput.value = ''
        renderAll()
      }
    }
    
    searchInput.oninput = ()=>{
      searchQuery = searchInput.value.trim()
      renderGrid(activeCat)
    }
    
    $('#clearSearch').onclick = ()=>{
      searchQuery = ''
      searchInput.value = ''
      searchBox.style.display = 'none'
      renderAll()
    }

    // site title save
    $('#saveTitle').onclick = ()=>{ 
      const v = $('#siteTitleInput').value.trim()
      if(!v) return alert('‚ö†Ô∏è Ba≈ülƒ±k bo≈ü olamaz!')
      document.title = v
      localStorage.setItem(CONFIG.siteKey, v)
      alert('‚úÖ Site ba≈ülƒ±ƒüƒ± kaydedildi!')
    }

    // helper saveAll & renderAll
    function saveAll(){ 
      save(CONFIG.videosKey, videos)
      save(CONFIG.catsKey, categories)
      localStorage.setItem(CONFIG.siteKey, document.title)
    }
    
    function renderAll(){ 
      renderCats()
      renderGrid(activeCat)
      renderReels()
      renderStats()
      document.title = localStorage.getItem(CONFIG.siteKey) || 'Video Portal Pro'
      $('#siteTitleInput').value = document.title
    }

    // help
    $('#helpBtn').onclick = (e)=>{ 
      e.preventDefault()
      alert(`üìñ Video Portal Pro - Yardƒ±m

üîê Admin Giri≈üi: ≈ûifre "school"
üé¨ Video Ekleme: MP4, iframe, reels destekler
üî• Reels: 30 saniye altƒ± videolar i√ßin
üë§ Admin-Only: Sadece admin g√∂rebilir
üîç Arama: Saƒü √ºstteki arama butonunu kullan
üìä ƒ∞statistikler: Ana sayfada g√∂sterilir

üí° ƒ∞pucu: Netlify'da host ederken videolarƒ± /videos/ klas√∂r√ºne koyun.`)
    }

    // Initial render
    updateAdminUI()
    renderAll()

    // Auto-logout on tab close (session-based)
    window.addEventListener('beforeunload', ()=>{
      // Session storage automatically clears
    })

    // Expose for inline handlers
    window.openEdit = openEdit
    window.playVideo = playVideo
  </script>
</body>
</html>